# X-Road Deployment Learnings

## 2025-01-20: NetworkPolicy Label Selector Fix

**Problem**: NetworkPolicies using outdated sandbox labels (sandbox-xroad-cs, sandbox-xroad-ss1) instead of actual Helm-generated pod labels, causing security policies to not apply to any pods.

**Root Cause**: Pod labels generated by Helm use pattern {fullnameOverride}-{serverId}, but NetworkPolicy selectors were hardcoded with sandbox values.

**Solution**: Updated NetworkPolicy podSelector labels to match actual pod labels:
- Central Server: sandbox-xroad-cs → cs-1
- Management Security Server: sandbox-xroad-ss1 → mss-0

**Files Modified**:
- metallb-services/bb-im/06-network-policies.yaml (2 selectors)
- metallb-services/bb-im-second/06-network-policies.yaml (1 selector)

**Verification**:
```bash
kubectl get networkpolicy -n xroad-im
kubectl describe networkpolicy xroad-cs-allow-traffic -n xroad-im
kubectl get pods -n xroad-im --show-labels | grep -E "cs-1|mss-0"
```

**Key Learning**: Always verify NetworkPolicy pod selectors match actual pod labels, especially when using Helm charts with dynamic label generation. Mismatch creates security gap where policies exist but don't apply.

**Merged**: PR #2 - https://github.com/vanillacore-net/xroad-rollout-charts/pull/2
